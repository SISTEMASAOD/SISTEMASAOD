<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Sistema SAOD - Cliente</title>
  <style>
    body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #22c55e, #16a34a); margin: 0; min-height: 100vh; }
    .container { max-width: 980px; margin: 40px auto; background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); padding: 30px; }
    h1, h2 { text-align: center; color: #22c55e; margin-bottom: 0.5em; }
    .section { display: none; }
    .section.active { display: block; }
    .btn-main { padding: 20px; border:none; border-radius:15px; font-size:1.2em; font-weight:600; cursor:pointer; margin:15px; width:320px; }
    .btn-green { background: linear-gradient(135deg,#22c55e,#16a34a); color:white; }
    .btn-orange { background: linear-gradient(135deg,#ea580c,#dc2626); color:white; }
    .input-dni { padding:15px; font-size:1.2em; border:2px solid #22c55e; border-radius:10px; width:250px; text-align:center; }
    .btn { padding: 12px 24px; margin: 10px 2px; border: none; border-radius: 10px; font-size: 1.1em; font-weight: 600; cursor: pointer;}
    .btn-cancel { background: #6b7280; color: white;}
    .info-box { background: #f0f9ff; padding: 20px; border-radius: 10px; margin: 25px auto; max-width: 460px;}
    .menu-categoria { margin-bottom: 25px;}
    .categoria-titulo { background: #ea580c; color: #fff; padding: 12px; border-radius: 10px; font-size: 1.1em; text-align:left; margin-bottom:8px;}
    .productos-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(270px,1fr)); gap: 16px;}
    .producto { background:#f5f5f5; border-radius:10px; padding:15px 10px; text-align:center; box-shadow: 0 2px 6px rgba(34,197,94,0.10);}
    .producto-nombre { font-weight:bold; margin-bottom:6px;}
    .producto-precio { color:#ea580c; font-weight:bold;}
    .producto-credicambios { color:#22c55e;}
    .btn-green { background: linear-gradient(135deg,#22c55e,#16a34a); color: #fff; border: none; border-radius: 10px; padding: 12px 38px; font-size: 1.1em; cursor: pointer; margin-top: 8px;}
    .plato-img { width: 120px; height: 90px; object-fit: cover; border-radius: 12px; margin-bottom: 10px; box-shadow: 0 2px 6px rgba(34,197,94,0.10); display: block; margin-left: auto; margin-right: auto; }
    @media (max-width:700px){.container{padding:8px;} .productos-grid { grid-template-columns: 1fr;}}
  </style>
</head>
<body>
  <div class="container">
    <div id="section-bienvenida" class="section active">
      <h1>ü•§ Sistema SAOD</h1>
      <h2>FRUCAMTO - Juguer√≠a & Cafeter√≠a</h2>
      <div style="text-align:center; margin-top:40px;">
        <button class="btn-main btn-green" onclick="mostrarSeccion('puntos')">üîç VER MIS PUNTOS</button>
        <button class="btn-main btn-orange" onclick="mostrarSeccion('menu')">üçΩÔ∏è MEN√ö FRUCAMTO</button>
      </div>
    </div>
    <div id="section-puntos" class="section">
      <h2>üîç Consultar CREDICAMBIOS</h2>
      <div style="text-align:center;">
        <input id="input-dni" class="input-dni" placeholder="DNI (8 d√≠gitos)" maxlength="8" pattern="[0-9]{8}">
        <button class="btn btn-green" onclick="consultarPuntos()">CONSULTAR</button>
        <button class="btn btn-cancel" onclick="salirCliente()">‚Üê Volver</button>
      </div>
      <div id="info-puntos"></div>
    </div>
    <div id="section-menu" class="section">
      <h2>üçΩÔ∏è MEN√ö FRUCAMTO</h2>
      <div class="menu-categoria">
        <div class="categoria-titulo">üåÖ DESAYUNOS ESPECIALES</div>
        <div class="productos-grid">
          <div class="producto">
            <img src="https://images.unsplash.com/photo-1504674900247-0877df9cc836?fit=crop&w=400&q=80" class="plato-img" alt="Dos Huevos Fritos/Tocino/Dos Panes/Jugo">
            <div class="producto-nombre">Dos Huevos Fritos/Tocino/Dos Panes/Jugo</div>
            <div class="producto-precio">S/. 15.00</div>
            <div class="producto-credicambios">Ganar√≠as: 1.5 CREDICAMBIOS</div>
            <button class="btn btn-green" onclick="pedirPlato('Dos Huevos Fritos/Tocino/Dos Panes/Jugo', 15)">Pedir</button>
          </div>
          <!-- Agrega aqu√≠ todos los productos y categor√≠as que necesites -->
        </div>
      </div>
      <div style="text-align:center; margin-top:30px;">
        <button class="btn btn-green" onclick="salirCliente()">‚Üê Volver al Men√∫ Principal</button>
      </div>
    </div>
  </div>
  <script>
    function mostrarSeccion(seccion) {
      document.querySelectorAll('.section').forEach(d => d.classList.remove('active'));
      document.getElementById(`section-${seccion}`).classList.add('active');
      if(seccion === 'puntos') document.getElementById('info-puntos').innerHTML = '';
    }
    function salirCliente() {
      dniCliente = '';
      document.getElementById('input-dni').value = '';
      document.getElementById('info-puntos').innerHTML = '';
      mostrarSeccion('bienvenida');
    }
    // Usa aqu√≠ tu URL de Render:
    const API_HOST = "https://saod-backend.onrender.com";
    let dniCliente = '';
    async function consultarPuntos() {
      let dni = document.getElementById('input-dni').value.trim();
      if (!dni || dni.length !== 8) return alert('Ingrese un DNI v√°lido de 8 d√≠gitos');
      try {
        let res = await fetch(`${API_HOST}/api/cliente/${dni}`);
        let data = await res.json();
        if (res.ok && data.cliente) {
          dniCliente = dni;
          document.getElementById('info-puntos').innerHTML = `
            <div class="info-box" style="text-align:center;">
              <h3>¬°Hola ${data.cliente.nombre}!</h3>
              <div style="font-size:2em;color:#ea580c;">${Math.round(data.cliente.credicambios)} CREDICAMBIOS</div>
              <div>üí∞ Equivalente a S/. ${data.cliente.equivalente_soles}</div>
              <div style="margin:10px 0 18px 0; background:${data.cliente.color_nivel};color:white;padding:5px 12px;border-radius:15px;display:inline-block;">
                ‚ú® Nivel ${data.cliente.nivel.replace('_',' ')}
              </div>
              <br><br>
              <button class="btn btn-orange" onclick="mostrarSeccion('menu')">üçΩÔ∏è IR AL MEN√ö FRUCAMTO</button>
              <button class="btn btn-green" onclick="salirCliente()">‚Üê Salir</button>
            </div>
          `;
        } else {
          document.getElementById('info-puntos').innerHTML =
            `<div style="color:red;margin-top:20px;">
                A√∫n no eres cliente.<br>
            </div>`;
        }
      } catch (e) {
        document.getElementById('info-puntos').innerHTML =
          `<div style="color:red;margin-top:20px;">Error de conexi√≥n</div>`;
      }
    }
    function pedirPlato(nombre, precio) {
      if (!dniCliente || dniCliente.length !== 8) {
        alert("Primero consulta tus puntos e ingresa tu DNI v√°lido.");
        mostrarSeccion('puntos');
        return;
      }
      if (confirm(`¬øDeseas pedir "${nombre}" por S/. ${precio}?`)) {
        fetch(`${API_HOST}/api/venta`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            dni: dniCliente,
            monto: precio,
            descripcion: nombre
          })
        })
        .then(res => res.json())
        .then(data => {
          if (data.credicambios_ganados !== undefined) {
            alert(`‚úÖ Pedido registrado\nCREDICAMBIOS: ${data.credicambios_ganados}\nNivel: ${data.nivel_cliente}`);
          } else {
            alert(data.error || 'Ocurri√≥ un error al registrar la compra.');
          }
        })
        .catch(() => alert('Error de conexi√≥n al servidor'));
      }
    }
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('input-dni').addEventListener('input', function() {
        this.value = this.value.replace(/[^0-9]/g, '').slice(0, 8);
      });
    });
  </script>
</body>
</html>
