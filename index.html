<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Sistema SAOD - Cliente</title>
  <style>
    body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #22c55e, #16a34a); margin: 0; min-height: 100vh; }
    .container { max-width: 980px; margin: 40px auto; background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); padding: 30px; }
    h1, h2 { text-align: center; color: #22c55e; margin-bottom: 0.5em; }
    .section { display: none; }
    .section.active { display: block; }
    .btn-main { padding: 20px; border:none; border-radius:15px; font-size:1.2em; font-weight:600; cursor:pointer; margin:15px; width:320px; }
    .btn-green { background: linear-gradient(135deg,#22c55e,#16a34a); color:white; }
    .btn-orange { background: linear-gradient(135deg,#ea580c,#dc2626); color:white; }
    .input-dni { padding:15px; font-size:1.2em; border:2px solid #22c55e; border-radius:10px; width:250px; text-align:center; }
    .btn { padding: 12px 24px; margin: 10px 2px; border: none; border-radius: 10px; font-size: 1.1em; font-weight: 600; cursor: pointer;}
    .btn-cancel { background: #6b7280; color: white;}
    .info-box { background: #f0f9ff; padding: 20px; border-radius: 10px; margin: 25px auto; max-width: 460px;}
    .menu-categoria { margin-bottom: 25px;}
    .categoria-titulo { background: #ea580c; color: #fff; padding: 12px; border-radius: 10px; font-size: 1.1em; text-align:left; margin-bottom:8px;}
    .productos-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(270px,1fr)); gap: 16px;}
    .producto { background:#f5f5f5; border-radius:10px; padding:15px 10px; text-align:center; box-shadow: 0 2px 6px rgba(34,197,94,0.10);}
    .producto-nombre { font-weight:bold; margin-bottom:6px;}
    .producto-precio { color:#ea580c; font-weight:bold;}
    .producto-credicambios { color:#22c55e;}
    .btn-green { background: linear-gradient(135deg,#22c55e,#16a34a); color: #fff; border: none; border-radius: 10px; padding: 12px 38px; font-size: 1.1em; cursor: pointer; margin-top: 8px;}
    .plato-img { width: 120px; height: 90px; object-fit: cover; border-radius: 12px; margin-bottom: 10px; box-shadow: 0 2px 6px rgba(34,197,94,0.10); display: block; margin-left: auto; margin-right: auto; }
    @media (max-width:700px){.container{padding:8px;} .productos-grid { grid-template-columns: 1fr;}}
  </style>
</head>
<body>
  <div class="container">
    <!-- Secci√≥n bienvenida -->
    <div id="section-bienvenida" class="section active">
      <h1>ü•§ Sistema SAOD</h1>
      <h2>FRUCAMTO - Juguer√≠a & Cafeter√≠a</h2>
      <div style="text-align:center; margin-top:40px;">
        <button class="btn-main btn-green" onclick="mostrarSeccion('puntos')">üîç VER MIS PUNTOS</button>
        <button class="btn-main btn-orange" onclick="mostrarSeccion('menu')">üçΩÔ∏è MEN√ö FRUCAMTO</button>
      </div>
    </div>

    <!-- Secci√≥n puntos -->
    <div id="section-puntos" class="section">
      <h2>üîç Consultar CREDICAMBIOS</h2>
      <div style="text-align:center;">
        <input id="input-dni" class="input-dni" placeholder="DNI (8 d√≠gitos)" maxlength="8" pattern="[0-9]{8}">
        <button class="btn btn-green" onclick="consultarPuntos()">CONSULTAR</button>
        <button class="btn btn-orange" onclick="mostrarSeccion('registro')">üÜï Cliente Nuevo</button>
        <button class="btn btn-cancel" onclick="salirCliente()">‚Üê Volver</button>
      </div>
      <div id="info-puntos"></div>
    </div>

    <!-- Secci√≥n men√∫/carta -->
    <div id="section-menu" class="section">
      <h2>üçΩÔ∏è MEN√ö FRUCAMTO</h2>
      <!-- ====== DESAYUNOS ESPECIALES ====== -->
      <div class="menu-categoria">
        <div class="categoria-titulo">üåÖ DESAYUNOS ESPECIALES</div>
        <div class="productos-grid">
          <div class="producto">
            <img src="https://images.unsplash.com/photo-1504674900247-0877df9cc836?fit=crop&w=400&q=80" class="plato-img" alt="Dos Huevos Fritos/Tocino/Dos Panes/Jugo">
            <div class="producto-nombre">Dos Huevos Fritos/Tocino/Dos Panes/Jugo</div>
            <div class="producto-precio">S/. 15.00</div>
            <div class="producto-credicambios">Ganar√≠as: 1.5 CREDICAMBIOS</div>
            <button class="btn btn-green" onclick="pedirPlato('Dos Huevos Fritos/Tocino/Dos Panes/Jugo', 15)">Pedir</button>
          </div>
          <div class="producto">
            <img src="https://images.unsplash.com/photo-1519864600265-abb23847ef2c?fit=crop&w=400&q=80" class="plato-img" alt="Pan con Palta y Caf√©">
            <div class="producto-nombre">Pan con Palta y Caf√©</div>
            <div class="producto-precio">S/. 10.00</div>
            <div class="producto-credicambios">Ganar√≠as: 1.0 CREDICAMBIOS</div>
            <button class="btn btn-green" onclick="pedirPlato('Pan con Palta y Caf√©', 10)">Pedir</button>
          </div>
          <div class="producto">
            <img src="https://images.unsplash.com/photo-1464306076886-debca5e8a6b0?fit=crop&w=400&q=80" class="plato-img" alt="Tostadas Francesas/Jugo">
            <div class="producto-nombre">Tostadas Francesas/Jugo</div>
            <div class="producto-precio">S/. 12.00</div>
            <div class="producto-credicambios">Ganar√≠as: 1.2 CREDICAMBIOS</div>
            <button class="btn btn-green" onclick="pedirPlato('Tostadas Francesas/Jugo', 12)">Pedir</button>
          </div>
        </div>
      </div>
      <!-- SANDWICHES Y PANES -->
      <div class="menu-categoria">
        <div class="categoria-titulo">ü•™ SANDWICHES Y PANES</div>
        <div class="productos-grid">
          <div class="producto">
            <img src="https://images.unsplash.com/photo-1519864600265-abb23847ef2c?fit=crop&w=400&q=80" class="plato-img" alt="Sandwich de Pollo">
            <div class="producto-nombre">Sandwich de Pollo</div>
            <div class="producto-precio">S/. 9.00</div>
            <div class="producto-credicambios">Ganar√≠as: 0.9 CREDICAMBIOS</div>
            <button class="btn btn-green" onclick="pedirPlato('Sandwich de Pollo', 9)">Pedir</button>
          </div>
          <div class="producto">
            <img src="https://images.unsplash.com/photo-1476718406336-bb5a9690ee2a?fit=crop&w=400&q=80" class="plato-img" alt="Pan con Chicharr√≥n">
            <div class="producto-nombre">Pan con Chicharr√≥n</div>
            <div class="producto-precio">S/. 10.00</div>
            <div class="producto-credicambios">Ganar√≠as: 1.0 CREDICAMBIOS</div>
            <button class="btn btn-green" onclick="pedirPlato('Pan con Chicharr√≥n', 10)">Pedir</button>
          </div>
        </div>
      </div>
      <!-- JUGOS Y CAF√âS -->
      <div class="menu-categoria">
        <div class="categoria-titulo">ü•§ JUGOS Y CAF√âS</div>
        <div class="productos-grid">
          <div class="producto">
            <img src="https://images.unsplash.com/photo-1504674900247-0877df9cc836?fit=crop&w=400&q=80" class="plato-img" alt="Jugo de Naranja">
            <div class="producto-nombre">Jugo de Naranja</div>
            <div class="producto-precio">S/. 7.00</div>
            <div class="producto-credicambios">Ganar√≠as: 0.7 CREDICAMBIOS</div>
            <button class="btn btn-green" onclick="pedirPlato('Jugo de Naranja', 7)">Pedir</button>
          </div>
          <div class="producto">
            <img src="https://images.unsplash.com/photo-1519864600265-abb23847ef2c?fit=crop&w=400&q=80" class="plato-img" alt="Caf√© Americano">
            <div class="producto-nombre">Caf√© Americano</div>
            <div class="producto-precio">S/. 6.00</div>
            <div class="producto-credicambios">Ganar√≠as: 0.6 CREDICAMBIOS</div>
            <button class="btn btn-green" onclick="pedirPlato('Caf√© Americano', 6)">Pedir</button>
          </div>
          <div class="producto">
            <img src="https://images.unsplash.com/photo-1519864600265-abb23847ef2c?fit=crop&w=400&q=80" class="plato-img" alt="Caf√© Latte">
            <div class="producto-nombre">Caf√© Latte</div>
            <div class="producto-precio">S/. 8.00</div>
            <div class="producto-credicambios">Ganar√≠as: 0.8 CREDICAMBIOS</div>
            <button class="btn btn-green" onclick="pedirPlato('Caf√© Latte', 8)">Pedir</button>
          </div>
        </div>
      </div>
      <!-- ENSALADAS Y FRUTAS -->
      <div class="menu-categoria">
        <div class="categoria-titulo">ü•ó ENSALADAS Y FRUTAS</div>
        <div class="productos-grid">
          <div class="producto">
            <img src="https://images.unsplash.com/photo-1502741338009-cac2772e18bc?fit=crop&w=400&q=80" class="plato-img" alt="Ensalada de Frutas">
            <div class="producto-nombre">Ensalada de Frutas</div>
            <div class="producto-precio">S/. 11.00</div>
            <div class="producto-credicambios">Ganar√≠as: 1.1 CREDICAMBIOS</div>
            <button class="btn btn-green" onclick="pedirPlato('Ensalada de Frutas', 11)">Pedir</button>
          </div>
          <div class="producto">
            <img src="https://images.unsplash.com/photo-1504674900247-0877df9cc836?fit=crop&w=400&q=80" class="plato-img" alt="Yogurt con Granola">
            <div class="producto-nombre">Yogurt con Granola</div>
            <div class="producto-precio">S/. 8.00</div>
            <div class="producto-credicambios">Ganar√≠as: 0.8 CREDICAMBIOS</div>
            <button class="btn btn-green" onclick="pedirPlato('Yogurt con Granola', 8)">Pedir</button>
          </div>
        </div>
      </div>
      <!-- ALMUERZOS -->
      <div class="menu-categoria">
        <div class="categoria-titulo">üçõ ALMUERZOS</div>
        <div class="productos-grid">
          <div class="producto">
            <img src="https://images.unsplash.com/photo-1502741338009-cac2772e18bc?fit=crop&w=400&q=80" class="plato-img" alt="Arroz con Pollo">
            <div class="producto-nombre">Arroz con Pollo</div>
            <div class="producto-precio">S/. 18.00</div>
            <div class="producto-credicambios">Ganar√≠as: 1.8 CREDICAMBIOS</div>
            <button class="btn btn-green" onclick="pedirPlato('Arroz con Pollo', 18)">Pedir</button>
          </div>
          <div class="producto">
            <img src="https://images.unsplash.com/photo-1519864600265-abb23847ef2c?fit=crop&w=400&q=80" class="plato-img" alt="Lomo Saltado">
            <div class="producto-nombre">Lomo Saltado</div>
            <div class="producto-precio">S/. 20.00</div>
            <div class="producto-credicambios">Ganar√≠as: 2.0 CREDICAMBIOS</div>
            <button class="btn btn-green" onclick="pedirPlato('Lomo Saltado', 20)">Pedir</button>
          </div>
        </div>
      </div>
      <div style="text-align:center; margin-top:30px;">
        <button class="btn btn-green" onclick="salirCliente()">‚Üê Volver al Men√∫ Principal</button>
      </div>
    </div>

    <!-- Secci√≥n registro de cliente nuevo -->
    <div id="section-registro" class="section">
      <h2>üÜï Registro de Cliente Nuevo</h2>
      <div style="max-width:350px;margin:auto;">
        <input id="reg-dni" class="input-dni" placeholder="DNI (8 d√≠gitos)" maxlength="8"><br>
        <button class="btn btn-green" onclick="consultarReniec()">Consultar RENIEC</button>
        <br>
        <input id="reg-nombre" class="input-dni" placeholder="Nombre completo"><br>
        <input id="reg-direccion" class="input-dni" placeholder="Direcci√≥n"><br>
        <input id="reg-telefono" class="input-dni" placeholder="Tel√©fono"><br>
        <button class="btn btn-orange" onclick="registrarCliente()">Registrar y entrar al mundo SAOD</button>
        <button class="btn btn-cancel" onclick="salirCliente()">‚Üê Volver</button>
        <div id="reg-msg" style="margin-top:10px;"></div>
      </div>
    </div>
  </div>
  <script>
    function mostrarSeccion(seccion) {
      document.querySelectorAll('.section').forEach(d => d.classList.remove('active'));
      document.getElementById(`section-${seccion}`).classList.add('active');
      if(seccion === 'puntos') document.getElementById('info-puntos').innerHTML = '';
      if(seccion === 'registro') {
        document.getElementById('reg-msg').innerHTML = '';
        document.getElementById('reg-dni').value = '';
        document.getElementById('reg-nombre').value = '';
        document.getElementById('reg-direccion').value = '';
        document.getElementById('reg-telefono').value = '';
      }
    }
    function salirCliente() {
      dniCliente = '';
      document.getElementById('input-dni').value = '';
      document.getElementById('info-puntos').innerHTML = '';
      mostrarSeccion('bienvenida');
    }
    const API_HOST = "https://saod-backend.onrender.com"; // <--- reemplaza por tu link real si es diferente
    let dniCliente = '';
    async function consultarPuntos() {
      let dni = document.getElementById('input-dni').value.trim();
      if (!dni || dni.length !== 8) return alert('Ingrese un DNI v√°lido de 8 d√≠gitos');
      try {
        let res = await fetch(`${API_HOST}/api/cliente/${dni}`);
        let data = await res.json();
        if (res.ok && data.cliente) {
          dniCliente = dni;
          document.getElementById('info-puntos').innerHTML = `
            <div class="info-box" style="text-align:center;">
              <h3>¬°Hola ${data.cliente.nombre}!</h3>
              <div style="font-size:2em;color:#ea580c;">${Math.round(data.cliente.credicambios)} CREDICAMBIOS</div>
              <div>üí∞ Equivalente a S/. ${data.cliente.equivalente_soles}</div>
              <div style="margin:10px 0 18px 0; background:${data.cliente.color_nivel};color:white;padding:5px 12px;border-radius:15px;display:inline-block;">
                ‚ú® Nivel ${data.cliente.nivel.replace('_',' ')}
              </div>
              <br><br>
              <button class="btn btn-orange" onclick="mostrarSeccion('menu')">üçΩÔ∏è IR AL MEN√ö FRUCAMTO</button>
              <button class="btn btn-green" onclick="salirCliente()">‚Üê Salir</button>
            </div>
          `;
        } else {
          document.getElementById('info-puntos').innerHTML =
            `<div style="color:red;margin-top:20px;">
                A√∫n no eres cliente.<br>
                <button class="btn btn-orange" onclick="mostrarSeccion('registro')">üÜï Reg√≠strate y entra al mundo SAOD</button>
            </div>`;
        }
      } catch (e) {
        document.getElementById('info-puntos').innerHTML =
          `<div style="color:red;margin-top:20px;">Error de conexi√≥n</div>`;
      }
    }
    function pedirPlato(nombre, precio) {
      if (!dniCliente || dniCliente.length !== 8) {
        alert("Primero consulta tus puntos e ingresa tu DNI v√°lido.");
        mostrarSeccion('puntos');
        return;
      }
      if (confirm(`¬øDeseas pedir "${nombre}" por S/. ${precio}?`)) {
        fetch(`${API_HOST}/api/venta`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            dni: dniCliente,
            monto: precio,
            descripcion: nombre
          })
        })
        .then(res => res.json())
        .then(data => {
          if (data.credicambios_ganados !== undefined) {
            alert(`‚úÖ Pedido registrado\nCREDICAMBIOS: ${data.credicambios_ganados}\nNivel: ${data.nivel_cliente}`);
          } else {
            alert(data.error || 'Ocurri√≥ un error al registrar la compra.');
          }
        })
        .catch(() => alert('Error de conexi√≥n al servidor'));
      }
    }
    async function consultarReniec() {
      let dni = document.getElementById('reg-dni').value.trim();
      if (!dni || dni.length !== 8) return alert('DNI inv√°lido');
      setTimeout(() => {
        document.getElementById('reg-nombre').value = "Nombre Apellido";
        document.getElementById('reg-direccion').value = "Direcci√≥n de ejemplo";
        document.getElementById('reg-telefono').value = "999999999";
        document.getElementById('reg-msg').innerHTML = '<span style="color:green">Datos RENIEC simulados. Completa si es necesario.</span>';
      }, 800);
    }
    async function registrarCliente() {
      let dni = document.getElementById('reg-dni').value.trim();
      let nombre = document.getElementById('reg-nombre').value.trim();
      let direccion = document.getElementById('reg-direccion').value.trim();
      let telefono = document.getElementById('reg-telefono').value.trim();
      if (!dni || dni.length!==8 || !nombre) {
        document.getElementById('reg-msg').innerHTML = '<span style="color:red">Completa DNI y nombre.</span>'; return;
      }
      try {
        let res = await fetch(`${API_HOST}/api/cliente`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ dni, nombre, direccion, telefono })
        });
        let data = await res.json();
        if(res.ok){
          document.getElementById('reg-msg').innerHTML = '<span style="color:green">‚úì Cliente registrado correctamente. Ya puedes usar el sistema.</span>';
          dniCliente = dni;
          document.getElementById('reg-dni').value = '';
          document.getElementById('reg-nombre').value = '';
          document.getElementById('reg-direccion').value = '';
          document.getElementById('reg-telefono').value = '';
          setTimeout(()=>{
            mostrarSeccion('puntos');
            document.getElementById('input-dni').value=dni;
            consultarPuntos();
          },1200);
        } else {
          document.getElementById('reg-msg').innerHTML = '<span style="color:red">'+(data.error||'Error al registrar')+'</span>';
        }
      } catch(e){
        document.getElementById('reg-msg').innerHTML = '<span style="color:red">Error de conexi√≥n</span>';
      }
    }
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('input-dni').addEventListener('input', function() {
        this.value = this.value.replace(/[^0-9]/g, '').slice(0, 8);
      });
      document.getElementById('reg-dni').addEventListener('input', function() {
        this.value = this.value.replace(/[^0-9]/g, '').slice(0, 8);
      });
    });
  </script>
</body>
</html>
